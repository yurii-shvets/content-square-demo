package com.contentsquare.rn.masking;

import android.app.Activity;
import android.util.Log;
import android.view.View;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;

import com.contentsquare.rn.utils.ReactNativeUiThreadUtil;
import com.contentsquare.rn.utils.ReactNativeViewFinder;
import com.facebook.react.bridge.ReactApplicationContext;

import com.contentsquare.android.Contentsquare;

public class ViewMasker {

    @NonNull
    private final ReactNativeViewFinder mReactNativeViewFinder;

    @NonNull
    private final ReactNativeUiThreadUtil mReactNativeUiThreadUtil;


    /**
     * Constructor.
     *
     * @param reactNativeViewFinder as {@link ReactNativeViewFinder}
     */
    public ViewMasker(@NonNull ReactNativeViewFinder reactNativeViewFinder, @NonNull ReactNativeUiThreadUtil reactNativeUiThreadUtil) {
        this.mReactNativeViewFinder = reactNativeViewFinder;
        this.mReactNativeUiThreadUtil = reactNativeUiThreadUtil;
    }

    public void maskView(@NonNull final ReactApplicationContext reactContext, final int viewTag) {
        mReactNativeUiThreadUtil.runOnUiThread(() -> {
            final Activity activity = reactContext.getCurrentActivity();
            if (activity == null) {
                return;
            }

            mReactNativeViewFinder.findView(reactContext, viewTag, view -> {
                Contentsquare.mask(view);
            });
        });
    }

    public void unmaskView(@NonNull final ReactApplicationContext reactContext, final int viewTag) {
        mReactNativeUiThreadUtil.runOnUiThread(() -> {
            final Activity activity = reactContext.getCurrentActivity();
            if (activity == null) {
                return;
            }

            mReactNativeViewFinder.findView(reactContext, viewTag, view -> {
                Contentsquare.unMask(view);
            });
        });
    }
}
